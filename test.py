import matplotlib.pyplot as plt
import re

# Paste the specific section of your log data here
log_text = """
      1/100      7.93G      1.704      2.338      1.366        424        640: 100% 
                   all        644       9797      0.535      0.382       0.41      0.248
      2/100      8.06G      1.163      1.354      1.059        436        640: 100% 
                   all        644       9797      0.592      0.451      0.478      0.297
      3/100      7.54G      1.082      1.229      1.015        533        640: 100% 
                   all        644       9797      0.595      0.454      0.459      0.279
      4/100      7.26G      1.042      1.177     0.9916        341        640: 100% 
                   all        644       9797      0.633      0.475      0.503      0.304
      5/100      7.85G     0.9833      1.086     0.9682        395        640: 100% 
                   all        644       9797      0.623      0.429      0.478      0.299
      6/100      8.01G     0.9661      1.065     0.9599        486        640: 100% 
                   all        644       9797      0.684      0.535       0.57      0.335
      7/100      7.13G     0.9252      1.009      0.949        412        640: 100% 
                   all        644       9797      0.668      0.546      0.577      0.354
      8/100      7.54G     0.9062     0.9782     0.9392        520        640: 100% 
                   all        644       9797      0.741       0.56      0.617      0.401
      9/100      7.98G     0.8791     0.9324     0.9321        444        640: 100% 
                   all        644       9797      0.768      0.573       0.63      0.404
     10/100      7.12G     0.8626     0.9107     0.9249        468        640: 100% 
                   all        644       9797      0.679      0.561        0.6      0.383
     11/100      7.62G     0.8568     0.9078     0.9226        421        640: 100% 
                   all        644       9797      0.609      0.586      0.613      0.398
     12/100      7.75G     0.8365     0.8756     0.9155        444        640: 100% 
                   all        644       9797      0.767      0.584      0.649       0.42
     13/100      7.55G     0.8362     0.8747     0.9163        392        640: 100% 
                   all        644       9797      0.764      0.626      0.678      0.453
     14/100      7.54G     0.8306     0.8526     0.9123        434        640: 100% 
                   all        644       9797      0.719      0.619      0.666      0.437
     15/100       7.4G      0.815     0.8302     0.9094        366        640: 100% 
                   all        644       9797      0.663      0.637      0.675      0.461
     16/100      8.12G     0.8046     0.8234      0.906        437        640: 100% 
                   all        644       9797      0.704      0.647      0.676      0.447
     17/100      7.37G     0.7913     0.8123     0.9063        459        640: 100% 
                   all        644       9797      0.665      0.618      0.659      0.445
     18/100      7.77G     0.7915     0.7997     0.9003        462        640: 100% 
                   all        644       9797      0.742      0.638      0.704      0.473
     19/100      7.62G     0.7717     0.7839     0.8989        410        640: 100% 
                   all        644       9797      0.714      0.629      0.681      0.459
     20/100      7.25G     0.7751      0.775     0.9012        505        640: 100% 
                   all        644       9797       0.74      0.647      0.696      0.476
     21/100      7.84G     0.7708     0.7772     0.8968        458        640: 100% 
                   all        644       9797      0.709      0.642      0.697      0.468
     22/100      7.24G      0.765     0.7556     0.8971        526        640: 100% 
                   all        644       9797      0.616       0.52      0.573      0.367
     23/100      7.24G     0.7403     0.7401     0.8922        412        640: 100% 
                   all        644       9797      0.725       0.64      0.699      0.471
     24/100      7.24G     0.7512     0.7432     0.8898        395        640: 100% 
                   all        644       9797       0.73      0.661      0.697      0.483
     25/100      7.78G     0.7343     0.7255     0.8884        379        640: 100% 
                   all        644       9797      0.755      0.631        0.7      0.468
     26/100      7.84G     0.7307     0.7216     0.8891        377        640: 100% 
                   all        644       9797      0.745       0.66       0.71      0.486
     27/100      7.41G     0.7317     0.7225      0.885        398        640: 100% 
                   all        644       9797      0.735      0.666      0.709      0.488
     28/100      7.46G      0.722     0.7087     0.8856        462        640: 100% 
                   all        644       9797      0.741      0.677      0.722      0.507
     29/100      7.33G     0.7134     0.6992      0.886        428        640: 100% 
                   all        644       9797      0.741      0.664      0.715      0.508
     30/100      7.49G     0.7251     0.7059     0.8851        425        640: 100% 
                   all        644       9797      0.749      0.704       0.74      0.506
     31/100      7.69G      0.714     0.7055     0.8818        480        640: 100% 
                   all        644       9797      0.741      0.665      0.725      0.501
     32/100      7.64G     0.7104     0.6856     0.8837        388        640: 100% 
                   all        644       9797       0.78      0.681      0.735      0.503
     33/100      7.48G     0.6926     0.6707     0.8813        429        640: 100% 
                   all        644       9797      0.774      0.667      0.718      0.491
     34/100      7.27G     0.6907     0.6701     0.8789        369        640: 100% 
                   all        644       9797      0.789      0.683      0.731       0.51
     35/100      7.82G     0.6944     0.6713     0.8792        352        640: 100% 
                   all        644       9797      0.758      0.684      0.725      0.492
     36/100      7.45G     0.6929     0.6688     0.8785        399        640: 100% 
                   all        644       9797      0.752      0.692      0.724      0.501
     37/100      7.57G     0.6845     0.6565     0.8764        393        640: 100% 
                   all        644       9797      0.815      0.704      0.758      0.529
     38/100      7.22G     0.6724     0.6355     0.8763        410        640: 100% 
                   all        644       9797      0.778      0.693       0.75      0.534
     39/100      7.67G     0.6794     0.6445     0.8766        441        640: 100% 
                   all        644       9797      0.766       0.67      0.725        0.5
     40/100      8.01G     0.6738     0.6364     0.8751        411        640: 100% 
                   all        644       9797      0.745      0.724      0.755      0.543
     41/100       7.3G     0.6777     0.6438     0.8765        399        640: 100% 
                   all        644       9797      0.815      0.708      0.751      0.529
     42/100      7.64G     0.6724     0.6353     0.8763        335        640: 100% 
                   all        644       9797      0.771      0.683      0.742      0.503
     43/100      7.33G     0.6632     0.6269     0.8734        404        640: 100% 
                   all        644       9797       0.74      0.672      0.733      0.519
     44/100      7.32G     0.6615      0.626     0.8718        403        640: 100% 
                   all        644       9797      0.757      0.711       0.75      0.516
     45/100      7.51G     0.6507     0.6136     0.8703        479        640: 100% 
                   all        644       9797      0.778      0.707      0.759      0.538
     46/100       7.8G       0.65     0.6135     0.8718        355        640: 100% 
                   all        644       9797      0.774      0.724      0.762      0.546
     47/100      7.23G     0.6407     0.5983     0.8673        302        640: 100% 
                   all        644       9797      0.752      0.695      0.742      0.515
     48/100       7.7G     0.6433     0.6037     0.8692        346        640: 100% 
                   all        644       9797      0.782      0.706      0.764      0.553
     49/100      7.34G     0.6363     0.5983     0.8656        336        640: 100% 
                   all        644       9797      0.778      0.721      0.763      0.546
     50/100       7.6G     0.6336     0.5937     0.8685        434        640: 100% 
                   all        644       9797      0.775      0.697      0.745      0.525
     51/100      7.54G      0.634     0.5901     0.8693        508        640: 100% 
                   all        644       9797      0.819      0.709      0.775      0.552
     52/100      7.05G     0.6232     0.5739     0.8654        386        640: 100% 
                   all        644       9797      0.815      0.703      0.754      0.538
     53/100      7.05G     0.6182     0.5701     0.8643        412        640: 100% 
                   all        644       9797      0.789      0.692      0.756      0.538
     54/100      7.46G       0.62     0.5789     0.8676        410        640: 100% 
                   all        644       9797      0.795      0.704      0.763      0.536
     55/100       7.6G     0.6207     0.5741     0.8664        473        640: 100% 
                   all        644       9797      0.803      0.721      0.762      0.539
     56/100      8.11G     0.6138     0.5687     0.8637        439        640: 100% 
                   all        644       9797      0.784      0.729      0.769      0.541
     57/100      7.11G     0.6087     0.5599      0.862        411        640: 100% 
                   all        644       9797      0.792       0.72      0.773       0.55
     58/100      7.65G     0.6075     0.5579     0.8628        370        640: 100% 
                   all        644       9797      0.793      0.731      0.771      0.552
"""

# Arrays to hold data
epochs = []
train_box = []
train_cls = []
train_dfl = []
val_map50 = []
val_map50_95 = []

# Parse the text
lines = log_text.strip().split('\n')
for i in range(0, len(lines), 2):  # Skip by 2 because log spans 2 lines per epoch
    try:
        line1 = lines[i]
        line2 = lines[i+1]
        
        # Regex to extract numbers from Line 1 (Training Losses)
        # Format: Epoch GPU Box Cls DFL ...
        parts1 = re.split(r'\s+', line1.strip())
        epoch_num = int(parts1[0].split('/')[0])
        box = float(parts1[2])
        cls = float(parts1[3])
        dfl = float(parts1[4])
        
        # Regex to extract numbers from Line 2 (Validation Metrics)
        # Format: Class Images Instances Box(P R mAP50 mAP50-95)
        parts2 = re.split(r'\s+', line2.strip())
        # mAP50 is usually the second to last, mAP50-95 is last
        map_50 = float(parts2[-2])
        map_50_95 = float(parts2[-1])
        
        epochs.append(epoch_num)
        train_box.append(box)
        train_cls.append(cls)
        train_dfl.append(dfl)
        val_map50.append(map_50)
        val_map50_95.append(map_50_95)
        
    except (IndexError, ValueError) as e:
        continue

# Setup the plot
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 6))

# Plot 1: Training Losses (Lower is better)
ax1.plot(epochs, train_box, label='Train Box Loss', color='blue')
ax1.plot(epochs, train_cls, label='Train Class Loss', color='orange')
ax1.plot(epochs, train_dfl, label='Train DFL Loss', color='green')
ax1.set_title('Training Losses (Lower is Better)')
ax1.set_xlabel('Epochs')
ax1.set_ylabel('Loss')
ax1.legend()
ax1.grid(True, alpha=0.3)

# Plot 2: Validation Metrics (Higher is better)
ax2.plot(epochs, val_map50, label='mAP @ 50', color='red')
ax2.plot(epochs, val_map50_95, label='mAP @ 50-95', color='purple')
ax2.axvline(x=48, color='grey', linestyle='--', label='Best Epoch (48)')
ax2.set_title('Validation Metrics (Higher is Better)')
ax2.set_xlabel('Epochs')
ax2.set_ylabel('mAP')
ax2.legend()
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()